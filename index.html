<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Galería de Agentes · Neon EVA Free Drag v2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg: #020617;
      --panel: rgba(15,23,42,0.96);
      --border: rgba(148,163,184,0.35);
      --text: #e5e7eb;
      --muted: #94a3b8;
      --accent: #22d3ee;
      --accent2: #a855f7;
    }

    * { box-sizing: border-box; margin:0; padding:0; }

    body {
      font-family: system-ui, sans-serif;
      background: radial-gradient(circle at top, #0f172a, #020617 70%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
    }

    /* SIDEBAR */
    .sidebar {
      width: 260px;
      padding: 18px;
      border-right: 1px solid var(--border);
      background: #020617;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .logo-block {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px;
      border-radius: 14px;
      background: rgba(15,23,42,0.9);
      border: 1px solid var(--border);
      box-shadow: 0 0 18px rgba(34,211,238,0.35);
    }

    .logo-block img {
      width: 50px;
      height: 50px;
      border-radius: 12px;
    }

    .logo-title { font-size: 14px; font-weight: 600; }
    .logo-sub   { font-size: 11px; color: var(--muted); }

    /* MAIN */
    .main {
      flex: 1;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .title {
      font-size: 18px;
      text-transform: uppercase;
      letter-spacing: .12em;
      font-weight: 700;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .subtitle {
      font-size: 12px;
      color: var(--muted);
    }

    /* ZONA DE JUEGO: altura fija grande para 3–4 filas */
    .playground {
      margin-top: 14px;
      position: relative;
      height: 900px;          /* <- CLAVE: altura fija grande */
      border-radius: 24px;
      background: radial-gradient(circle at top, #020617, #020617 60%);
      overflow: hidden;
    }

    .agent-card {
      width: 180px;
      background: var(--panel);
      border-radius: 18px;
      border: 1px solid var(--border);
      padding: 12px;
      position: absolute;
      overflow: hidden;
      box-shadow:
        0 0 20px rgba(34,211,238,0.22),
        0 0 28px rgba(168,85,247,0.3);
      transition:
        box-shadow 0.15s ease-out,
        opacity 0.1s ease-out;
      cursor: grab;
      user-select: none;
    }

    .agent-card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: repeating-linear-gradient(
        to bottom,
        rgba(148,163,184,0.18),
        rgba(148,163,184,0.18) 1px,
        transparent 2px,
        transparent 3px
      );
      opacity: 0.15;
      mix-blend-mode: soft-light;
      pointer-events: none;
    }

    .agent-card:hover {
      box-shadow:
        0 0 28px rgba(34,211,238,0.35),
        0 0 40px rgba(168,85,247,0.35);
    }

    .agent-card.dragging {
      opacity: 0.6;
      cursor: grabbing;
      box-shadow:
        0 0 32px rgba(34,211,238,0.55),
        0 0 52px rgba(168,85,247,0.6);
    }

    .robot {
      position: relative;
      width: 100%;
      padding-top: 100%; /* cuadrado */
      border-radius: 14px;
      background: radial-gradient(circle at top, #22d3ee, #0f172a);
      overflow: hidden;
      box-shadow: inset 0 0 16px rgba(15,23,42,0.9);
    }

    .robot-inner {
      position: absolute;
      inset: 10%;
      border-radius: 12px;
      background: #020617;
      border: 2px solid rgba(15,23,42,0.9);
      display: flex;
      flex-direction: column;
      padding: 6px;
      gap: 4px;
    }

    .robot-screen {
      position: relative;
      flex: 1;
      border-radius: 8px;
      background:
        linear-gradient(135deg, rgba(34,211,238,0.18), rgba(168,85,247,0.26)),
        repeating-linear-gradient(
          to bottom,
          rgba(15,23,42,0.8),
          rgba(15,23,42,0.8) 2px,
          rgba(30,64,175,0.6) 3px,
          rgba(15,23,42,0.8) 4px
        );
      overflow: hidden;
    }

    .robot-screen::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(
        to bottom,
        transparent 0%,
        rgba(15,23,42,0.4) 50%,
        transparent 100%
      );
      mix-blend-mode: soft-light;
      opacity: 0.7;
      pointer-events: none;
    }

    .matrix-layer {
      position: absolute;
      inset: 0;
      overflow: hidden;
    }

    .eva-face {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      pointer-events: none;
    }

    .eva-eyes {
      display: flex;
      gap: 14px;
      margin-bottom: 6px;
    }

    .eva-eye {
      width: 22px;
      height: 12px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #e0f2fe, #22d3ee);
      box-shadow:
        0 0 10px rgba(34,211,238,0.9),
        0 0 18px rgba(56,189,248,0.8);
      transform-origin: center center;
      animation: blink 6s infinite;
    }

    .eva-eye.right { animation-delay: .2s; }

    @keyframes blink {
      0%, 88%, 100% { transform: scaleY(1); }
      90% { transform: scaleY(0.1); }
      92% { transform: scaleY(1); }
    }

    .eva-mouth {
      width: 26px;
      height: 4px;
      border-radius: 999px;
      background: rgba(148,163,184,0.9);
      box-shadow: 0 0 10px rgba(148,163,184,0.9);
      opacity: 0.9;
    }

    .robot-eyes {
      display: flex;
      justify-content: center;
      gap: 6px;
      margin-top: 4px;
    }

    .eye {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: #22d3ee;
      box-shadow:
        0 0 10px #22d3ee,
        0 0 18px #22d3ee;
    }

    .robot-label {
      margin-top: 8px;
      font-size: 12px;
      font-weight: 600;
    }

    .robot-tag {
      font-size: 11px;
      color: var(--muted);
    }

    .matrix-stream {
      position: absolute;
      top: 0;
      white-space: pre;
      font-family: monospace;
      color: rgba(226,232,240,0.9);
      text-shadow: 0 0 6px #22d3ee;
      opacity: 0.85;
      animation-name: fall;
      animation-timing-function: linear;
      animation-iteration-count: infinite;
    }

    @keyframes fall {
      0%   { transform: translateY(-115%); }
      100% { transform: translateY(115%); }
    }

    /* MODAL */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }

    .modal {
      width: 100%;
      max-width: 420px;
      background: var(--panel);
      border-radius: 18px;
      border: 1px solid var(--border);
      box-shadow:
        0 0 26px rgba(34,211,238,0.45),
        0 0 40px rgba(168,85,247,0.4);
      padding: 18px 18px 14px;
      position: relative;
    }

    .modal-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 4px;
      color: var(--accent);
    }

    .modal-sub {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 10px;
    }

    .modal-body {
      font-size: 13px;
      line-height: 1.5;
      margin-bottom: 12px;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    .btn {
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 12px;
      border: 1px solid var(--border);
      background: rgba(15,23,42,0.9);
      color: var(--text);
      cursor: pointer;
    }

    .btn-primary {
      border: none;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      color: #020617;
      font-weight: 600;
      box-shadow: 0 0 16px rgba(34,211,238,0.6);
    }

    .modal-close {
      position: absolute;
      right: 12px;
      top: 10px;
      font-size: 16px;
      cursor: pointer;
      color: var(--muted);
    }

    @media (max-width: 900px) {
      body { flex-direction: column; }
      .sidebar {
        width: 100%;
        height: auto;
        border-right: none;
        border-bottom: 1px solid var(--border);
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
      }
      .main { padding: 16px; }
      .agent-card { width: 160px; }
    }
  </style>
</head>
<body>
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="logo-block">
      <img src="https://is1-ssl.mzstatic.com/image/thumb/Purple221/v4/3c/a8/68/3ca86816-6029-891b-4f8c-1dfb7c72a5d6/AppIcon-0-1x_U007ephone-0-1-0-sRGB-85-220-0.png/200x200ia-75.webp" alt="Logo" />
      <div>
        <div class="logo-title">API Factory</div>
        <div class="logo-sub">Gobierno de APIs y Microservicios</div>
      </div>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <div>
      <div class="title">Galería de Agentes</div>
      <div class="subtitle">
        Agentes EVA con Matrix “Servicios Financieros BanCoppel”.<br>
        Arrástralos libremente: hay espacio vertical para 3–4 filas.
      </div>
    </div>

    <div class="playground" id="playground"></div>
  </main>

  <!-- MODAL -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal">
      <div class="modal-close" id="modalClose">✕</div>
      <div class="modal-title" id="modalTitle">Agente</div>
      <div class="modal-sub" id="modalSubtitle">Tipo / Dominio</div>
      <div class="modal-body" id="modalBody">
        Aquí se mostrará la descripción del agente seleccionado.
      </div>
      <div class="modal-footer">
        <button class="btn" id="modalCancel">Cerrar</button>
        <button class="btn btn-primary" id="modalGo">Abrir agente</button>
      </div>
    </div>
  </div>

  <script>
    const agents = [
      { id:"createApiMule", nombre:"Agent Create API Mulesoft", tipo:"Creación de API",
        dominio:"MuleSoft · API-led · RAML",
        descripcion:"Asiste en la creación de APIs base en MuleSoft siguiendo lineamientos de gobierno y plantillas del CoE.",
        url:"agents/chat_mule.html"},
      { id:"createDtm", nombre:"Agent Create DTM from HDU&DTC", tipo:"Prediseño Técnico",
        dominio:"DTM · HDU · DTC",
        descripcion:"Genera DTMs iniciales a partir de HDU y DTC, alineando el diseño técnico con el modelo BIAN.",
        url:"agents/chat_dtm.html"},
      { id:"createRaml", nombre:"Agent Create RAML", tipo:"Diseño de Especificación",
        dominio:"RAML · API Design",
        descripcion:"Construye especificaciones RAML a partir de plantillas y modelos canónicos definidos por el CoE.",
        url:"agents/chat_raml.html"},
      { id:"validatorHduDtm", nombre:"Agent Validator HDU&DTCvsDTM", tipo:"Validación de Diseño",
        dominio:"HDU · DTC · DTM",
        descripcion:"Valida la consistencia entre HDU, DTC y DTM detectando brechas y sugerencias de mejora.",
        url:"agents/chat_validator.html"},
      { id:"archCoE", nombre:"Agent Archetype CoE", tipo:"Arquetipo CoE",
        dominio:"Centros de Excelencia",
        descripcion:"Propone arquetipos de agentes y APIs reutilizables para el CoE de Gobierno y Arquitectura.",
        url:"agents/chat_business.html"},
      { id:"archJava", nombre:"Agent Archetype APificacion Java 21", tipo:"Arquetipo Técnico",
        dominio:"Java 21 · Spring Boot",
        descripcion:"Sugiere patrones de apificación con Java 21 y Spring Boot alineados al estándar interno.",
        url:"agents/chat_java.html"},
      { id:"orchApigee", nombre:"Agent Orchestration Base - APIgee", tipo:"Orquestación",
        dominio:"Apigee · Proxy · Flujos",
        descripcion:"Arma orquestaciones base en Apigee para exponer servicios core mediante proxies gobernados.",
        url:"agents/chat_apigee.html"},
      { id:"orchMule", nombre:"Agent Orchestration Base - Mulesoft BC", tipo:"Orquestación",
        dominio:"MuleSoft · Business Capability",
        descripcion:"Diseña flujos de orquestación base en MuleSoft por capacidad de negocio, alineados a BIAN.",
        url:"agents/chat_mule.html"},
      { id:"creatorDom", nombre:"Agent Creador API Dom", tipo:"Creador de API",
        dominio:"APIs de Dominio",
        descripcion:"Genera propuestas de APIs de Dominio con enfoque en encapsulamiento funcional.",
        url:"#"},
      { id:"creatorBc", nombre:"Agent Creador API Bc", tipo:"Creador de API",
        dominio:"APIs de Business Capability",
        descripcion:"Sugiere APIs por capacidad de negocio, útiles para desacoplar proyectos como Apolo/Afore.",
        url:"#"},
      { id:"creatorRec", nombre:"Agent Creador API Rec", tipo:"Creador de API",
        dominio:"APIs de Recurso",
        descripcion:"Diseña APIs de Recurso centradas en entidades maestras y catálogos críticos.",
        url:"#"},
      { id:"creatorProxy", nombre:"Agent Creador API Proxy", tipo:"Creador de API",
        dominio:"APIs Proxy · Edge",
        descripcion:"Construye APIs Proxy para frontales o canales, respetando contratos e integración con gateways.",
        url:"#"}
    ];

    const playground = document.getElementById("playground");

    // Render inicial en 4 columnas x 3 filas
    agents.forEach((agent, index) => {
      const card = document.createElement("article");
      card.className = "agent-card";
      card.dataset.id = agent.id;

      card.innerHTML = `
        <div class="robot">
          <div class="robot-inner">
            <div class="robot-screen">
              <div class="matrix-layer"></div>
              <div class="eva-face">
                <div class="eva-eyes">
                  <div class="eva-eye left"></div>
                  <div class="eva-eye right"></div>
                </div>
                <div class="eva-mouth"></div>
              </div>
            </div>
            <div class="robot-eyes">
              <div class="eye"></div>
              <div class="eye"></div>
            </div>
          </div>
        </div>
        <div class="robot-label">${agent.nombre}</div>
        <div class="robot-tag">${agent.tipo}</div>
      `;

      const cols = 4;
      const col = index % cols;
      const row = Math.floor(index / cols); // 0,1,2
      const gapX = 24;
      const gapY = 40;
      const cardWidth = 180;
      const rowHeight = 220;

      const left = gapX + col * (cardWidth + gapX);
      const top = gapY + row * rowHeight; // 3 filas visibles

      card.style.left = left + "px";
      card.style.top = top + "px";

      card.addEventListener("click", (e) => {
        if (card.classList.contains("dragging-click-lock")) {
          card.classList.remove("dragging-click-lock");
          return;
        }
        openModal(agent);
      });

      makeDraggable(card, playground);
      playground.appendChild(card);
    });

    // Matrix
    const phrase = "SERVICIOS FINANCIEROS BANCOPPEL";

    function initMatrixScreens() {
      const layers = document.querySelectorAll(".matrix-layer");
      layers.forEach(layer => {
        const streamsCount = 2 + Math.floor(Math.random() * 3);
        for (let i = 0; i < streamsCount; i++) {
          const stream = document.createElement("div");
          stream.className = "matrix-stream";

          let txt = "";
          const repetitions = 10 + Math.floor(Math.random() * 8);
          for (let r = 0; r < repetitions; r++) {
            const idx = Math.floor(Math.random() * phrase.length);
            txt += phrase[idx] + "\n";
          }
          stream.textContent = txt;

          const left = 5 + Math.random() * 80;
          const duration = 8 + Math.random() * 10;
          const fontSize = 9 + Math.random() * 6;
          const delay = Math.random() * 5;

          stream.style.left = left + "%";
          stream.style.animationDuration = duration + "s";
          stream.style.animationDelay = delay + "s";
          stream.style.fontSize = fontSize + "px";

          layer.appendChild(stream);
        }
      });
    }

    // Drag libre dentro de la playground
    function makeDraggable(card, container) {
      let offsetX = 0, offsetY = 0;
      let dragging = false;
      let moved = false;
      let zIndexCounter = 10;

      card.addEventListener("mousedown", (e) => {
        dragging = true;
        moved = false;
        card.classList.add("dragging");
        card.style.zIndex = zIndexCounter++;
        const rect = card.getBoundingClientRect();
        const contRect = container.getBoundingClientRect();
        offsetX = e.clientX - rect.left;
        offsetY = e.clientY - rect.top;
        e.preventDefault();
      });

      window.addEventListener("mousemove", (e) => {
        if (!dragging) return;
        moved = true;

        const contRect = container.getBoundingClientRect();
        let x = e.clientX - contRect.left - offsetX;
        let y = e.clientY - contRect.top - offsetY;

        const maxX = contRect.width - card.offsetWidth;
        const maxY = contRect.height - card.offsetHeight; // ahora 900px reales

        x = Math.max(0, Math.min(x, maxX));
        y = Math.max(0, Math.min(y, maxY));

        card.style.left = x + "px";
        card.style.top = y + "px";
      });

      window.addEventListener("mouseup", () => {
        if (!dragging) return;
        dragging = false;
        card.classList.remove("dragging");
        if (moved) {
          card.classList.add("dragging-click-lock");
          setTimeout(() => card.classList.remove("dragging-click-lock"), 150);
        }
      });
    }

    // MODAL
    const modalBackdrop = document.getElementById("modalBackdrop");
    const modalTitle = document.getElementById("modalTitle");
    const modalSubtitle = document.getElementById("modalSubtitle");
    const modalBody = document.getElementById("modalBody");
    const modalClose = document.getElementById("modalClose");
    const modalCancel = document.getElementById("modalCancel");
    const modalGo = document.getElementById("modalGo");
    let currentAgentUrl = "#";

    function openModal(agent) {
      modalTitle.textContent = agent.nombre;
      modalSubtitle.textContent = `${agent.tipo} · ${agent.dominio}`;
      modalBody.textContent = agent.descripcion;
      currentAgentUrl = agent.url || "#";
      modalBackdrop.style.display = "flex";
    }

    function closeModal() {
      modalBackdrop.style.display = "none";
    }

    modalClose.addEventListener("click", closeModal);
    modalCancel.addEventListener("click", closeModal);
    modalBackdrop.addEventListener("click", (e) => {
      if (e.target === modalBackdrop) closeModal();
    });

    modalGo.addEventListener("click", () => {
      if (currentAgentUrl && currentAgentUrl !== "#") {
        window.location.href = currentAgentUrl;
      } else {
        closeModal();
      }
    });

    window.addEventListener("load", initMatrixScreens);
  </script>
</body>
</html>
